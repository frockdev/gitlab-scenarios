include:
  - local: gitlab-synchronized-tool/templates/only-tbd.yaml
  - local: gitlab-synchronized-tool/templates/simple-build.yaml

build-review:
  variables:
    BUILD_TAG: ${CI_COMMIT_REF_SLUG}
  extends:
    - .build
    - .only-REVIEW-manual

build-test-image-review:
  variables:
    BUILD_TAG: ${CI_COMMIT_SHA}
  extends:
    - .build
    - .only-REVIEW
  stage: build-test-image
  script:
    - docker pull ${LOCAL_IMAGE_FOR_BUILD}
    - docker pull ${BASE_IMAGE_FOR_BUILD}
    - docker build --file Dockerfile --build-arg LOCAL_IMAGE=$LOCAL_IMAGE_FOR_BUILD --build-arg BASE_IMAGE=$LOCAL_IMAGE_FOR_BUILD --tag ${APP_IMAGE_NAME}-tests:${BUILD_TAG} --target testing .
    - docker push ${APP_IMAGE_NAME}-tests:${BUILD_TAG}