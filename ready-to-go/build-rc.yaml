include:
  - local: gitlab-synchronized-tool/templates/only-tbd.yaml

build-rc:
  stage: build
  variables:
    BASE_IMAGE: vladitot/php83-swow-ubuntu-base
  needs:
    - tests-rc
  extends:
    - .only-RC
    - .build

build-test-image-rc:
  variables:
    BUILD_TAG: ${CI_COMMIT_SHA}
  extends:
    - .build
    - .only-RC
  stage: build-test-image
  script:
    - docker pull ${LOCAL_IMAGE_FOR_BUILD}
    - docker pull ${BASE_IMAGE_FOR_BUILD}
    - docker build --file Dockerfile --build-arg LOCAL_IMAGE=$LOCAL_IMAGE_FOR_BUILD --build-arg BASE_IMAGE=$LOCAL_IMAGE_FOR_BUILD --tag ${APP_IMAGE_NAME}-tests:${BUILD_TAG} --target testing .
    - docker push ${APP_IMAGE_NAME}-tests:${BUILD_TAG}