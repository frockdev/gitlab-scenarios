include:
  - local: gitlab-synchronized-tool/templates/simple-build.yaml
  - local: gitlab-synchronized-tool/templates/only-tbd.yaml

build-rc:
  stage: build
  variables:
    BASE_IMAGE: vladitot/php83-swow-ubuntu-base
  extends:
    - .only-RC
    - .build
  script:
    - docker pull ${LOCAL_IMAGE_FOR_BUILD}
    - docker pull ${BASE_IMAGE_FOR_BUILD}
    - docker build --file Dockerfile --build-arg LOCAL_IMAGE=$LOCAL_IMAGE_FOR_BUILD --build-arg BASE_IMAGE=$BASE_IMAGE_FOR_BUILD --tag ${APP_IMAGE_NAME}:${BUILD_TAG} --target production .
    - docker push ${APP_IMAGE_NAME}:${BUILD_TAG}