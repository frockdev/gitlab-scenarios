.build:
  retry: 2
  variables:
    APP_IMAGE_NAME: ${CI_REGISTRY_CUSTOM_REGISTRY}/${CI_PROJECT_PATH}/application
    DOCKER_DAEMON_OPTIONS: "--registry-mirror=https://${REGISTRY_MIRROR}"
    LOCAL_IMAGE_FOR_BUILD: vladitot/php83-swow-ubuntu-local
    BASE_IMAGE_FOR_BUILD: vladitot/php83-swow-ubuntu-base
    BUILD_TAG: ${CI_COMMIT_SHA}
  interruptible: true
  stage: build
  allow_failure: false
  tags:
    - docker-v2
  services:
    - name: docker:dind
      entrypoint: [ "sh", "-c", "dockerd-entrypoint.sh $DOCKER_DAEMON_OPTIONS" ]
  image: vladitot/docker-devspace:latest
  before_script:
    - docker login -u gitlab-ci-token -p $CI_JOB_TOKEN $CI_REGISTRY